<?php

/**
 * @file
 * General functionality and hook implementations.
 */

use Drupal\views\ViewExecutable;

/**
 * Implements hook_views_pre_view().
 */
function uwmcms_chew_views_views_pre_view(ViewExecutable $view, $display_id, array &$args) {
  if ($view->id() == 'latest_articles_by_category') {
    $node = \Drupal::routeMatch()->getParameter('node');
    if ($node) {
      $category = $node->field_categories->entity;
      $parents = \Drupal::entityTypeManager()->getStorage('taxonomy_term')->loadParents($category->id());
      if (empty($parents)) {
        $args[0] = $category->id();
      }
      else {
        $parent = array_shift($parents);
        $args[0] = $parent->id();
      }
    }
  }
}
